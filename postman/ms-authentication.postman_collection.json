{
  "info": {
    "_postman_id": "c5d4190a-0ef7-4d16-a9ce-55b61f4086a4",
    "name": "MS Authentication API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Coleção para testar a API de autenticação com segurança adicional (Redis + PostgreSQL)."
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Signup",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{user_name}}\",\n  \"email\": \"{{user_email}}\",\n  \"password\": \"{{user_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/signup",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "v1",
                "auth",
                "signup"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.token) {",
                  "    pm.collectionVariables.set(\"auth_token\", json.token);",
                  "  }",
                  "  if (json.userId) {",
                  "    pm.collectionVariables.set(\"user_id\", json.userId);",
                  "  }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"password\": \"{{user_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "v1",
                "auth",
                "login"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Meu Perfil (/me)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const token = pm.collectionVariables.get(\"auth_token\");",
                  "if (!token) {",
                  "  console.warn(\"Token nao encontrado. Execute o login antes de chamar o /me.\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/auth/me",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "v1",
                "auth",
                "me"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Rate Limit Status",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/v1/auth/rate-limit-status?email={{user_email}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "v1",
                "auth",
                "rate-limit-status"
              ],
              "query": [
                {
                  "key": "email",
                  "value": "{{user_email}}"
                }
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Password Recovery",
      "item": [
        {
          "name": "Request Recovery Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.recoveryToken) {",
                  "    pm.collectionVariables.set(\"recovery_token\", json.recoveryToken);",
                  "  }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"name\": \"{{user_name}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/password-recovery/request",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "v1",
                "auth",
                "password-recovery",
                "request"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Validate Recovery Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"token\": \"{{recovery_token}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/password-recovery/validate",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "v1",
                "auth",
                "password-recovery",
                "validate"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Reset Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const newPassword = pm.collectionVariables.get(\"new_user_password\");",
                  "  if (newPassword) {",
                    "    pm.collectionVariables.set(\"user_password\", newPassword);",
                  "  }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"token\": \"{{recovery_token}}\",\n  \"new_password\": \"{{new_user_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/password-recovery/reset",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "v1",
                "auth",
                "password-recovery",
                "reset"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "user_name",
      "value": "Usuario Teste",
      "type": "string"
    },
    {
      "key": "user_email",
      "value": "teste@exemplo.com",
      "type": "string"
    },
    {
      "key": "user_password",
      "value": "Senha123!",
      "type": "string"
    },
    {
      "key": "new_user_password",
      "value": "NovaSenha123!",
      "type": "string"
    },
    {
      "key": "auth_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "recovery_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string"
    }
  ]
}
